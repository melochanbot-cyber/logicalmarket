<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogicalMarket â€” Asset Movements Dashboard</title>
    <meta name="description" content="Real-time asset movements dashboard tracking Gold, Silver, S&P 500, Nasdaq, Bitcoin, Ethereum, Oil, and USD Index.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“Š</text></svg>">
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CSS RESET & VARIABLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: #1a2332;
            --bg-card-hover: #1f2b3d;
            --border: #2a3548;
            --text-primary: #e8edf5;
            --text-secondary: #8899aa;
            --text-muted: #556677;
            --green: #00d4aa;
            --green-bg: rgba(0, 212, 170, 0.08);
            --green-border: rgba(0, 212, 170, 0.25);
            --red: #ff4757;
            --red-bg: rgba(255, 71, 87, 0.08);
            --red-border: rgba(255, 71, 87, 0.25);
            --blue: #4a9eff;
            --yellow: #ffc048;
            --purple: #a78bfa;
            --orange: #fb923c;
            --cyan: #22d3ee;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
            --radius: 12px;
            --radius-sm: 8px;
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BASE STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        html { font-size: 16px; scroll-behavior: smooth; }

        body {
            font-family: var(--font-sans);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HEADER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .header {
            background: linear-gradient(180deg, rgba(17, 24, 39, 0.95) 0%, rgba(10, 14, 23, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1440px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--green), var(--blue));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--bg-primary);
            letter-spacing: -1px;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text span { color: var(--green); }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--green-bg);
            border: 1px solid var(--green-border);
            color: var(--green);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .last-updated {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .refresh-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            font-family: var(--font-sans);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .refresh-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
            border-color: var(--blue);
        }

        .refresh-btn.loading .refresh-icon { animation: spin 1s linear infinite; }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAIN LAYOUT
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .main {
            max-width: 1440px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Market Summary Bar */
        .market-summary {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem 0;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .market-summary::-webkit-scrollbar { display: none; }

        .summary-chip {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            white-space: nowrap;
            flex-shrink: 0;
            transition: var(--transition);
        }

        .summary-chip:hover { border-color: var(--blue); }

        .summary-chip .name { color: var(--text-secondary); font-weight: 500; }
        .summary-chip .price { color: var(--text-primary); font-weight: 600; font-family: var(--font-mono); }
        .summary-chip .change { font-weight: 600; font-family: var(--font-mono); font-size: 0.75rem; }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .section-header h2 {
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .section-header .badge {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(74, 158, 255, 0.1);
            color: var(--blue);
            border: 1px solid rgba(74, 158, 255, 0.2);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ASSET CARDS GRID
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .asset-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .asset-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            transition: var(--transition);
        }

        .asset-card.positive::before { background: var(--green); }
        .asset-card.negative::before { background: var(--red); }

        .asset-card:hover {
            border-color: var(--blue);
            background: var(--bg-card-hover);
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .asset-info { display: flex; align-items: center; gap: 0.75rem; }

        .asset-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .asset-name { font-weight: 600; font-size: 0.95rem; }
        .asset-symbol { font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono); }

        .asset-change {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
        }

        .change-pct {
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 1rem;
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
        }

        .change-pct.positive { color: var(--green); background: var(--green-bg); }
        .change-pct.negative { color: var(--red); background: var(--red-bg); }

        .change-abs {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .card-price {
            font-family: var(--font-mono);
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -1px;
            margin-bottom: 0.75rem;
        }

        /* Sparkline canvas */
        .sparkline-container {
            width: 100%;
            height: 50px;
            margin-bottom: 0.75rem;
            border-radius: 6px;
            overflow: hidden;
            background: rgba(0,0,0,0.15);
        }

        .sparkline-container canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255,255,255,0.04);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .meta-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        .meta-value { font-size: 0.8rem; font-family: var(--font-mono); font-weight: 600; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           AI COMMENTARY FEED
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .commentary-feed {
            max-height: 520px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 2rem;
            padding-right: 0.25rem;
        }

        .commentary-entry {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            transition: var(--transition);
            position: relative;
        }

        .commentary-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 3px;
            border-radius: var(--radius) 0 0 var(--radius);
            background: var(--blue);
        }

        .commentary-entry:hover {
            border-color: var(--blue);
            background: var(--bg-card-hover);
        }

        .commentary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.6rem;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .commentary-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .commentary-time {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--text-muted);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .commentary-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.65;
            margin-bottom: 0.75rem;
        }

        .commentary-movers {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .commentary-mover-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .commentary-mover-chip.positive {
            background: var(--green-bg);
            border: 1px solid var(--green-border);
            color: var(--green);
        }

        .commentary-mover-chip.negative {
            background: var(--red-bg);
            border: 1px solid var(--red-border);
            color: var(--red);
        }

        .commentary-mover-chip .symbol {
            color: var(--text-secondary);
        }

        .commentary-fallback {
            text-align: center;
            padding: 2.5rem 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }

        .commentary-fallback .icon {
            font-size: 1.75rem;
            margin-bottom: 0.6rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOVERS TABLE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .movers-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .movers-panel .panel-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mover-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1.25rem;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            transition: var(--transition);
        }

        .mover-row:last-child { border-bottom: none; }
        .mover-row:hover { background: var(--bg-card-hover); }

        .mover-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .mover-rank {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            background: rgba(255,255,255,0.05);
            color: var(--text-muted);
        }

        .mover-name { font-weight: 600; font-size: 0.85rem; }
        .mover-symbol { font-size: 0.7rem; color: var(--text-muted); font-family: var(--font-mono); }

        .mover-right {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mover-price { font-family: var(--font-mono); font-size: 0.85rem; color: var(--text-secondary); }

        .mover-change {
            font-family: var(--font-mono);
            font-weight: 700;
            font-size: 0.85rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            min-width: 70px;
            text-align: center;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NEWS SECTION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .news-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            transition: var(--transition);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .news-card:hover {
            border-color: var(--blue);
            background: var(--bg-card-hover);
            transform: translateY(-1px);
        }

        .news-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: fit-content;
        }

        .news-tag.market { background: rgba(74, 158, 255, 0.1); color: var(--blue); }
        .news-tag.crypto { background: rgba(251, 146, 60, 0.1); color: var(--orange); }
        .news-tag.commodity { background: rgba(255, 192, 72, 0.1); color: var(--yellow); }
        .news-tag.economy { background: rgba(167, 139, 250, 0.1); color: var(--purple); }

        .news-title {
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-meta {
            font-size: 0.7rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: auto;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FOOTER
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .footer {
            text-align: center;
            padding: 2rem 1.5rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .footer a { color: var(--blue); text-decoration: none; }
        .footer a:hover { text-decoration: underline; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOADING & ERROR STATES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .loading-skeleton {
            background: linear-gradient(90deg, var(--bg-card) 25%, var(--bg-card-hover) 50%, var(--bg-card) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes shimmer { to { background-position: -200% 0; } }

        .error-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
        }

        .error-state .icon { font-size: 2rem; margin-bottom: 0.75rem; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 768px) {
            .header { padding: 0.75rem 1rem; }
            .main { padding: 1rem; }
            .assets-grid { grid-template-columns: 1fr; }
            .two-col { grid-template-columns: 1fr; }
            .news-grid { grid-template-columns: 1fr; }
            .card-price { font-size: 1.4rem; }
            .logo-text { font-size: 1.1rem; }
            .header-meta { gap: 0.5rem; }
        }

        @media (max-width: 480px) {
            .assets-grid { gap: 0.75rem; }
            .asset-card { padding: 1rem; }
            .summary-chip { padding: 0.4rem 0.6rem; font-size: 0.75rem; }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- HEADER -->
    <header class="header">
        <div class="header-inner">
            <div class="logo">
                <div class="logo-icon">LM</div>
                <div class="logo-text">Logical<span>Market</span></div>
            </div>
            <div class="header-meta">
                <div class="status-badge" id="statusBadge">
                    <div class="status-dot"></div>
                    <span>Loading...</span>
                </div>
                <div class="last-updated" id="lastUpdated">â€”</div>
                <button class="refresh-btn" id="refreshBtn" onclick="refreshAll()">
                    <span class="refresh-icon">â†»</span> Refresh
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main">

        <!-- Market Summary Ticker -->
        <div class="market-summary" id="marketSummary">
            <!-- Populated by JS -->
        </div>

        <!-- Asset Cards -->
        <div class="section-header">
            <h2>ğŸ“Š Asset Overview</h2>
            <span class="badge">Live</span>
        </div>
        <div class="assets-grid" id="assetsGrid">
            <!-- Populated by JS -->
        </div>

        <!-- AI Commentary -->
        <div class="section-header">
            <h2>ğŸ¤– AI Market Commentary</h2>
            <span class="badge">Feed</span>
        </div>
        <div class="commentary-feed" id="commentaryFeed">
            <div class="commentary-fallback">
                <div class="icon">ğŸ¤–</div>
                <p>Loading commentary...</p>
            </div>
        </div>

        <!-- Movers -->
        <div class="section-header">
            <h2>ğŸ”¥ Market Movers</h2>
            <span class="badge">Sorted by Change</span>
        </div>
        <div class="two-col" id="moversSection">
            <div class="movers-panel">
                <div class="panel-header">ğŸŸ¢ Top Gainers</div>
                <div id="gainers"><!-- Populated by JS --></div>
            </div>
            <div class="movers-panel">
                <div class="panel-header">ğŸ”´ Top Losers</div>
                <div id="losers"><!-- Populated by JS --></div>
            </div>
        </div>

        <!-- News / Reasons -->
        <div class="section-header">
            <h2>ğŸ“° Market Movers &amp; Reasons</h2>
            <span class="badge">News</span>
        </div>
        <div class="news-grid" id="newsGrid">
            <!-- Populated by JS -->
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <p>LogicalMarket â€” Data from Yahoo Finance via GitHub Actions â€¢ News from Google News RSS</p>
        <p style="margin-top: 0.5rem;">Data updates every 5 min (market hours) / 30 min (off-hours) â€¢ Built with vanilla HTML/CSS/JS</p>
        <p style="margin-top: 0.5rem;">
            <a href="https://github.com/melochanbot-cyber/logicalmarket" target="_blank">GitHub</a>
        </p>
    </footer>

    <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONFIGURATION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const ASSETS = [
        { symbol: 'GC=F',      name: 'Gold',       icon: 'ğŸ¥‡', category: 'commodity', color: '#ffc048' },
        { symbol: 'SI=F',      name: 'Silver',     icon: 'ğŸ¥ˆ', category: 'commodity', color: '#c0c0c0' },
        { symbol: 'CL=F',      name: 'Crude Oil',  icon: 'ğŸ›¢ï¸', category: 'commodity', color: '#8b6914' },
        { symbol: '^GSPC',     name: 'S&P 500',    icon: 'ğŸ“ˆ', category: 'index',     color: '#4a9eff' },
        { symbol: '^IXIC',     name: 'Nasdaq',     icon: 'ğŸ’»', category: 'index',     color: '#a78bfa' },
        { symbol: '^DJI',      name: 'Dow Jones',  icon: 'ğŸ›ï¸', category: 'index',     color: '#60a5fa' },
        { symbol: 'BTC-USD',   name: 'Bitcoin',    icon: 'â‚¿',  category: 'crypto',    color: '#fb923c' },
        { symbol: 'ETH-USD',   name: 'Ethereum',   icon: 'Î',  category: 'crypto',    color: '#818cf8' },
        { symbol: 'DX-Y.NYB',  name: 'USD Index',  icon: 'ğŸ’µ', category: 'currency',  color: '#22d3ee' },
    ];

    const CORS_PROXIES = [
        (url) => `https://corsproxy.io/?${encodeURIComponent(url)}`,
        (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
        (url) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
    ];

    const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 minutes
    let assetData = {};
    let refreshTimer = null;
    let dataUpdatedAt = null; // timestamp from market.json

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DATA FETCHING â€” Static JSON (GitHub Actions) as primary
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    async function fetchWithProxy(url) {
        for (let i = 0; i < CORS_PROXIES.length; i++) {
            try {
                const proxyUrl = CORS_PROXIES[i](url);
                const resp = await fetch(proxyUrl, { signal: AbortSignal.timeout(12000) });
                if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                return await resp.json();
            } catch (e) {
                console.warn(`Proxy ${i} failed for ${url}:`, e.message);
                if (i === CORS_PROXIES.length - 1) throw e;
            }
        }
    }

    function getDataAge(updatedAt) {
        if (!updatedAt) return '';
        const diff = Math.floor((Date.now() - new Date(updatedAt).getTime()) / 1000);
        if (diff < 60) return `${diff}s old`;
        if (diff < 3600) return `${Math.floor(diff / 60)}m old`;
        if (diff < 86400) return `${Math.floor(diff / 3600)}h old`;
        return `${Math.floor(diff / 86400)}d old`;
    }

    async function fetchAllAssets() {
        // Primary: fetch pre-built static JSON from GitHub Actions
        try {
            const resp = await fetch('./data/market.json?t=' + Date.now(), { signal: AbortSignal.timeout(10000) });
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const json = await resp.json();

            if (json.assets && json.updatedAt) {
                dataUpdatedAt = json.updatedAt;
                const assetMap = ASSETS.reduce((m, a) => { m[a.symbol] = a; return m; }, {});

                for (const [sym, d] of Object.entries(json.assets)) {
                    const meta = assetMap[sym] || {};
                    if (d.error) {
                        assetData[sym] = { ...meta, symbol: sym, price: null, dailyChange: 0, dailyChangePct: 0, weekChange: 0, weekChangePct: 0, sparkData: [], high: null, low: null, loaded: true, error: true };
                    } else {
                        assetData[sym] = {
                            ...meta,
                            symbol: sym,
                            price: d.price,
                            prevClose: d.prevClose,
                            dailyChange: d.dailyChange,
                            dailyChangePct: d.dailyChangePct,
                            weekChange: d.price && d.sparkData?.length ? d.price - d.sparkData[0] : 0,
                            weekChangePct: d.weekChangePct,
                            sparkData: d.sparkData || [],
                            high: d.high,
                            low: d.low,
                            volume: d.volume || 0,
                            currency: d.currency || 'USD',
                            marketState: d.marketState || 'CLOSED',
                            loaded: true,
                            error: false,
                        };
                    }
                }
                console.log(`Loaded ${Object.keys(json.assets).length} assets from static JSON (${getDataAge(json.updatedAt)})`);
                return assetData;
            }
        } catch (e) {
            console.warn('Static market.json fetch failed, no fallback available:', e);
        }

        // If static JSON failed, mark all assets as errored
        ASSETS.forEach(a => {
            if (!assetData[a.symbol]) {
                assetData[a.symbol] = { ...a, price: null, dailyChange: 0, dailyChangePct: 0, weekChange: 0, weekChangePct: 0, sparkData: [], high: null, low: null, loaded: true, error: true };
            }
        });
        return assetData;
    }

    async function fetchNews() {
        const queries = ['stock+market', 'bitcoin+crypto', 'gold+commodity', 'economy+fed'];
        const allArticles = [];

        for (const q of queries) {
            try {
                const url = `https://news.google.com/rss/search?q=${q}+when:1d&hl=en-US&gl=US&ceid=US:en`;
                const proxyUrl = CORS_PROXIES[0](url);
                const resp = await fetch(proxyUrl, { signal: AbortSignal.timeout(10000) });
                const text = await resp.text();

                const parser = new DOMParser();
                const xml = parser.parseFromString(text, 'text/xml');
                const items = xml.querySelectorAll('item');

                items.forEach((item, idx) => {
                    if (idx >= 4) return; // limit per query
                    const title = item.querySelector('title')?.textContent || '';
                    const link = item.querySelector('link')?.textContent || '#';
                    const pubDate = item.querySelector('pubDate')?.textContent || '';
                    const source = item.querySelector('source')?.textContent || 'News';

                    // Categorize
                    let tag = 'market';
                    const lTitle = title.toLowerCase();
                    if (lTitle.match(/bitcoin|crypto|ethereum|btc|eth|defi|altcoin/)) tag = 'crypto';
                    else if (lTitle.match(/gold|silver|oil|commodity|crude/)) tag = 'commodity';
                    else if (lTitle.match(/fed|inflation|gdp|jobs|economy|rate|treasury/)) tag = 'economy';

                    allArticles.push({ title, link, pubDate, source, tag });
                });
            } catch (e) {
                console.warn(`News fetch failed for "${q}":`, e);
            }
        }

        // Deduplicate by title similarity and limit
        const seen = new Set();
        return allArticles.filter(a => {
            const key = a.title.slice(0, 50).toLowerCase();
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
        }).slice(0, 12);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RENDERING
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    function formatPrice(price, symbol) {
        if (price == null) return 'â€”';
        // Crypto gets more decimals at low prices, indices get fewer
        if (symbol?.includes('BTC') && price > 1000) return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        if (symbol?.includes('ETH') && price > 100) return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        if (price > 1000) return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        if (price > 10) return price.toFixed(2);
        return price.toFixed(4);
    }

    function formatChange(val) {
        if (val == null || isNaN(val)) return '0.00%';
        const sign = val >= 0 ? '+' : '';
        return `${sign}${val.toFixed(2)}%`;
    }

    function formatAbsChange(val, symbol) {
        if (val == null || isNaN(val)) return '';
        const sign = val >= 0 ? '+' : '';
        return `${sign}${formatPrice(val, symbol)}`;
    }

    function drawSparkline(canvas, data, color, isPositive) {
        if (!data || data.length < 2) return;
        const ctx = canvas.getContext('2d');
        const dpr = window.devicePixelRatio || 1;
        const w = canvas.offsetWidth;
        const h = canvas.offsetHeight;
        canvas.width = w * dpr;
        canvas.height = h * dpr;
        ctx.scale(dpr, dpr);

        const min = Math.min(...data);
        const max = Math.max(...data);
        const range = max - min || 1;
        const padding = 2;

        // Gradient fill
        const lineColor = isPositive ? 'rgba(0, 212, 170, 0.9)' : 'rgba(255, 71, 87, 0.9)';
        const fillTop = isPositive ? 'rgba(0, 212, 170, 0.15)' : 'rgba(255, 71, 87, 0.15)';
        const fillBot = 'rgba(0, 0, 0, 0)';

        ctx.beginPath();
        data.forEach((val, i) => {
            const x = (i / (data.length - 1)) * (w - padding * 2) + padding;
            const y = h - padding - ((val - min) / range) * (h - padding * 2);
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });

        ctx.strokeStyle = lineColor;
        ctx.lineWidth = 1.5;
        ctx.lineJoin = 'round';
        ctx.stroke();

        // Fill area under the line
        const lastX = (data.length - 1) / (data.length - 1) * (w - padding * 2) + padding;
        ctx.lineTo(lastX, h);
        ctx.lineTo(padding, h);
        ctx.closePath();

        const grad = ctx.createLinearGradient(0, 0, 0, h);
        grad.addColorStop(0, fillTop);
        grad.addColorStop(1, fillBot);
        ctx.fillStyle = grad;
        ctx.fill();
    }

    function renderSummaryBar(data) {
        const container = document.getElementById('marketSummary');
        const items = Object.values(data).filter(d => d.loaded && !d.error);
        if (items.length === 0) {
            container.innerHTML = '<div style="color: var(--text-muted); font-size: 0.8rem; padding: 0.5rem;">Loading market data...</div>';
            return;
        }
        container.innerHTML = items.map(d => {
            const cls = d.dailyChangePct >= 0 ? 'positive' : 'negative';
            const color = d.dailyChangePct >= 0 ? 'var(--green)' : 'var(--red)';
            return `
                <div class="summary-chip">
                    <span class="name">${d.name}</span>
                    <span class="price">${formatPrice(d.price, d.symbol)}</span>
                    <span class="change" style="color: ${color}">${formatChange(d.dailyChangePct)}</span>
                </div>
            `;
        }).join('');
    }

    function renderAssetCards(data) {
        const container = document.getElementById('assetsGrid');
        const items = Object.values(data);

        if (items.length === 0) {
            container.innerHTML = Array(9).fill(0).map(() =>
                `<div class="asset-card">
                    <div class="loading-skeleton" style="height: 200px;"></div>
                </div>`
            ).join('');
            return;
        }

        container.innerHTML = items.map(d => {
            if (d.error) {
                return `
                    <div class="asset-card">
                        <div class="card-top">
                            <div class="asset-info">
                                <div class="asset-icon" style="background: rgba(255,255,255,0.05);">${d.icon}</div>
                                <div>
                                    <div class="asset-name">${d.name}</div>
                                    <div class="asset-symbol">${d.symbol}</div>
                                </div>
                            </div>
                        </div>
                        <div class="error-state">
                            <div class="icon">âš ï¸</div>
                            <p style="font-size: 0.8rem;">Data unavailable</p>
                        </div>
                    </div>
                `;
            }

            const isPositive = d.dailyChangePct >= 0;
            const cls = isPositive ? 'positive' : 'negative';
            const canvasId = `spark-${d.symbol.replace(/[^a-zA-Z0-9]/g, '_')}`;

            return `
                <div class="asset-card ${cls}">
                    <div class="card-top">
                        <div class="asset-info">
                            <div class="asset-icon" style="background: ${d.color}22; color: ${d.color}; font-weight: 800;">${d.icon}</div>
                            <div>
                                <div class="asset-name">${d.name}</div>
                                <div class="asset-symbol">${d.symbol}</div>
                            </div>
                        </div>
                        <div class="asset-change">
                            <div class="change-pct ${cls}">${formatChange(d.dailyChangePct)}</div>
                            <div class="change-abs">${formatAbsChange(d.dailyChange, d.symbol)}</div>
                        </div>
                    </div>
                    <div class="card-price">${d.currency === 'USD' ? '$' : ''}${formatPrice(d.price, d.symbol)}</div>
                    <div class="sparkline-container">
                        <canvas id="${canvasId}"></canvas>
                    </div>
                    <div class="card-meta">
                        <div class="meta-item">
                            <span class="meta-label">5D High</span>
                            <span class="meta-value">${formatPrice(d.high, d.symbol)}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">5D Low</span>
                            <span class="meta-value">${formatPrice(d.low, d.symbol)}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">Week</span>
                            <span class="meta-value" style="color: ${d.weekChangePct >= 0 ? 'var(--green)' : 'var(--red)'}">${formatChange(d.weekChangePct)}</span>
                        </div>
                        <div class="meta-item">
                            <span class="meta-label">State</span>
                            <span class="meta-value" style="font-size: 0.7rem;">${d.marketState === 'REGULAR' ? 'ğŸŸ¢ Open' : d.marketState === 'PRE' ? 'ğŸŸ¡ Pre' : d.marketState === 'POST' ? 'ğŸŸ¡ Post' : 'âšª Closed'}</span>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        // Draw sparklines after DOM is updated
        requestAnimationFrame(() => {
            items.forEach(d => {
                if (d.error || !d.sparkData || d.sparkData.length < 2) return;
                const canvasId = `spark-${d.symbol.replace(/[^a-zA-Z0-9]/g, '_')}`;
                const canvas = document.getElementById(canvasId);
                if (canvas) drawSparkline(canvas, d.sparkData, d.color, d.dailyChangePct >= 0);
            });
        });
    }

    function renderMovers(data) {
        const items = Object.values(data).filter(d => d.loaded && !d.error && d.price != null);
        const sorted = [...items].sort((a, b) => b.dailyChangePct - a.dailyChangePct);

        const gainers = sorted.filter(d => d.dailyChangePct >= 0);
        const losers = sorted.filter(d => d.dailyChangePct < 0).reverse();

        const renderList = (list, containerId) => {
            const container = document.getElementById(containerId);
            if (list.length === 0) {
                container.innerHTML = '<div class="mover-row" style="justify-content: center; color: var(--text-muted); font-size: 0.8rem;">No data</div>';
                return;
            }
            container.innerHTML = list.map((d, i) => {
                const isPos = d.dailyChangePct >= 0;
                const color = isPos ? 'var(--green)' : 'var(--red)';
                const bg = isPos ? 'var(--green-bg)' : 'var(--red-bg)';
                return `
                    <div class="mover-row">
                        <div class="mover-left">
                            <div class="mover-rank">${i + 1}</div>
                            <div>
                                <div class="mover-name">${d.icon} ${d.name}</div>
                                <div class="mover-symbol">${d.symbol}</div>
                            </div>
                        </div>
                        <div class="mover-right">
                            <div class="mover-price">$${formatPrice(d.price, d.symbol)}</div>
                            <div class="mover-change" style="color: ${color}; background: ${bg};">
                                ${formatChange(d.dailyChangePct)}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        };

        renderList(gainers, 'gainers');
        renderList(losers, 'losers');
    }

    function renderNews(articles) {
        const container = document.getElementById('newsGrid');
        if (!articles || articles.length === 0) {
            container.innerHTML = `
                <div class="error-state" style="grid-column: 1 / -1;">
                    <div class="icon">ğŸ“°</div>
                    <p style="font-size: 0.85rem;">News loading or unavailable</p>
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">Will retry on next refresh</p>
                </div>
            `;
            return;
        }

        const tagLabels = {
            market: 'ğŸ“ˆ Markets',
            crypto: 'â‚¿ Crypto',
            commodity: 'ğŸ›¢ï¸ Commodities',
            economy: 'ğŸ›ï¸ Economy',
        };

        container.innerHTML = articles.map(a => {
            const date = a.pubDate ? new Date(a.pubDate) : null;
            const timeAgo = date ? getTimeAgo(date) : '';
            return `
                <a class="news-card" href="${a.link}" target="_blank" rel="noopener">
                    <div class="news-tag ${a.tag}">${tagLabels[a.tag] || 'ğŸ“Š Market'}</div>
                    <div class="news-title">${escapeHtml(a.title)}</div>
                    <div class="news-meta">
                        <span>${escapeHtml(a.source)}</span>
                        <span>â€¢</span>
                        <span>${timeAgo}</span>
                    </div>
                </a>
            `;
        }).join('');
    }

    function getTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        if (seconds < 60) return 'just now';
        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
        if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
        return `${Math.floor(seconds / 86400)}d ago`;
    }

    function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AI COMMENTARY
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    async function fetchCommentary() {
        try {
            const resp = await fetch('./data/commentary.json', { signal: AbortSignal.timeout(8000) });
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            return await resp.json();
        } catch (e) {
            console.warn('Commentary fetch failed:', e);
            return null;
        }
    }

    function formatCommentaryTime(timestamp) {
        try {
            const date = new Date(timestamp);
            if (isNaN(date.getTime())) return timestamp;
            const now = new Date();
            const diffMs = now - date;
            const diffH = Math.floor(diffMs / 3600000);
            const diffD = Math.floor(diffMs / 86400000);

            const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true, timeZone: 'America/New_York' });
            const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', timeZone: 'America/New_York' });

            if (diffD === 0 && diffH < 24) {
                if (diffH < 1) return `${Math.max(1, Math.floor(diffMs / 60000))}m ago`;
                return `${diffH}h ago Â· ${timeStr} ET`;
            }
            return `${dateStr} Â· ${timeStr} ET`;
        } catch {
            return timestamp;
        }
    }

    function renderCommentary(entries) {
        const container = document.getElementById('commentaryFeed');

        if (!entries || entries.length === 0) {
            container.innerHTML = `
                <div class="commentary-fallback">
                    <div class="icon">ğŸ¤–</div>
                    <p>Commentary updates during US market hours (Monâ€“Fri, 9 AM â€“ 4 PM ET)</p>
                </div>
            `;
            return;
        }

        // Sort newest first
        const sorted = [...entries].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        container.innerHTML = sorted.map(entry => {
            const moversHtml = (entry.movers && entry.movers.length > 0)
                ? `<div class="commentary-movers">
                    ${entry.movers.map(m => {
                        const isPositive = m.change && m.change.trim().startsWith('+');
                        const isNegative = m.change && m.change.trim().startsWith('-');
                        const cls = isPositive ? 'positive' : isNegative ? 'negative' : 'positive';
                        return `<span class="commentary-mover-chip ${cls}">
                            <span class="symbol">${escapeHtml(m.symbol)}</span> ${escapeHtml(m.change)}
                        </span>`;
                    }).join('')}
                   </div>`
                : '';

            return `
                <div class="commentary-entry">
                    <div class="commentary-header">
                        <div class="commentary-title">ğŸ’¬ ${escapeHtml(entry.title)}</div>
                        <div class="commentary-time">${formatCommentaryTime(entry.timestamp)}</div>
                    </div>
                    <div class="commentary-text">${escapeHtml(entry.commentary)}</div>
                    ${moversHtml}
                </div>
            `;
        }).join('');
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN REFRESH LOGIC
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    async function refreshAll() {
        const btn = document.getElementById('refreshBtn');
        const badge = document.getElementById('statusBadge');
        const updated = document.getElementById('lastUpdated');

        btn.classList.add('loading');
        badge.innerHTML = '<div class="status-dot" style="background: var(--yellow);"></div><span>Updating...</span>';
        badge.style.borderColor = 'rgba(255, 192, 72, 0.25)';
        badge.style.background = 'rgba(255, 192, 72, 0.08)';
        badge.style.color = 'var(--yellow)';

        try {
            // Fetch assets, news, and commentary in parallel
            const [_, articles, commentary] = await Promise.all([
                fetchAllAssets(),
                fetchNews(),
                fetchCommentary(),
            ]);

            renderSummaryBar(assetData);
            renderAssetCards(assetData);
            renderCommentary(commentary);
            renderMovers(assetData);
            renderNews(articles);

            const now = new Date();
            const ageStr = dataUpdatedAt ? ` Â· Data ${getDataAge(dataUpdatedAt)}` : '';
            updated.textContent = `Updated ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}${ageStr}`;

            const loadedCount = Object.values(assetData).filter(d => d.loaded && !d.error).length;
            badge.innerHTML = `<div class="status-dot"></div><span>${loadedCount}/${ASSETS.length} Assets</span>`;
            badge.style.borderColor = 'rgba(0, 212, 170, 0.25)';
            badge.style.background = 'rgba(0, 212, 170, 0.08)';
            badge.style.color = 'var(--green)';

        } catch (e) {
            console.error('Refresh failed:', e);
            badge.innerHTML = '<div class="status-dot" style="background: var(--red); animation: none;"></div><span>Error</span>';
            badge.style.borderColor = 'rgba(255, 71, 87, 0.25)';
            badge.style.background = 'rgba(255, 71, 87, 0.08)';
            badge.style.color = 'var(--red)';
        }

        btn.classList.remove('loading');
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
        // Show loading skeletons
        renderAssetCards({});
        refreshAll();

        // Auto-refresh
        refreshTimer = setInterval(refreshAll, REFRESH_INTERVAL);
    });

    // Handle window resize for sparklines
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            Object.values(assetData).forEach(d => {
                if (d.error || !d.sparkData || d.sparkData.length < 2) return;
                const canvasId = `spark-${d.symbol.replace(/[^a-zA-Z0-9]/g, '_')}`;
                const canvas = document.getElementById(canvasId);
                if (canvas) drawSparkline(canvas, d.sparkData, d.color, d.dailyChangePct >= 0);
            });
        }, 250);
    });
    </script>

</body>
</html>
